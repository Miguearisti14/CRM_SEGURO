{% extends 'layout_panel.html' %}
{% load static %}

{% block title %}Consultar Reclamaciones - ZuluAris CRM{% endblock %}

{% block content %}

    <div class="card-header">
        <h2 class="titulo-seccion">Consultar Reclamaciones</h2>
    </div>
<div class="card">
    <form class="consulta-filtros" method="get" action="">
        <div class="grupo-busqueda">
            <input 
                type="text" 
                name="q" 
                value="{{ query }}" 
                placeholder="Buscar por nombre, DNI o descripción..."
                class="input-busqueda"
            >
            <select name="estado" class="input-select">
                <option value="">Todos los estados</option>
                {% for estado in estados %}
                    <option value="{{ estado.id }}" {% if estado_id == estado.id|stringformat:"s" %}selected{% endif %}>
                        {{ estado.descripcion }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn-buscar">Buscar</button>
            <a href="{% url 'reclamaciones' %}" class="btn-limpiar">Limpiar filtros</a>
        </div>
    </form>

    <table class="tabla_reclamaciones">
        <thead>
            <tr>
                <th class="col-header col-dni">DNI</th>
                <th class="col-header col-nombre">Cliente</th>
                <th class="col-header col-asunto">Descripción</th>
                <th class="col-header col-fecha">Fecha</th>
                <th class="col-header col-estado">Estado</th>
                <th class="col-header col-detalles">Detalles</th>
            </tr>
        </thead>
        <tbody>
            {% if reclamaciones %}
                {% for r in reclamaciones %}
                <tr>
                    <td class="col-dni">{{ r.dni_cliente.dni }}</td>
                    <td class="col-nombre">
                        <a href="{% url 'detalle_cliente' r.dni_cliente.dni %}" class="cliente-link">
                            {{ r.dni_cliente.nombre }}
                        </a>
                    </td>
                    <td class="col-asunto">{{ r.descripcion|default:"-" }}</td>
                    <td class="col-fecha">{{ r.fecha|date:"Y-m-d" }}</td>
                    <td class="col-estado">{{ r.id_estado.descripcion|default:"-" }}</td>
                    <td class="col-detalles">
                        <a href="{% url 'detalle_reclamacion' r.id %}" class="cliente-link">
                            Ver
                        </a>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" style="text-align:center;">No hay reclamaciones registradas.</td>
                </tr>
            {% endif %}
        </tbody>
    </table>

    <div class="acciones-polizas">
        <a href="{% url 'crear_reclamacion' %}" class="btn-guardar">Nueva reclamación</a>
    </div>
</div>
{% endblock %}